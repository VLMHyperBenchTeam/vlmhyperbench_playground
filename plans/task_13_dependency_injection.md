# Задача 13: Динамическая Инъекция Зависимостей (Dependency Injection)

## Цель
Реализовать универсальный механизм установки Python-пакетов в запущенные Docker-контейнеры, абстрагируясь от конкретного пакетного менеджера (`pip` vs `uv`).

## Контекст
См. [ADR-002: Dynamic Dependencies](../docs_site/docs/architecture/adr/002-dynamic-dependencies.md).
Мы используем разные базовые образы:
*   `vllm/vllm-openai`: Основан на Ubuntu, использует системный `pip`.
*   `vlmhyperbench/vlm-base-hf`: Наш кастомный образ, использует `uv` для скорости.
*   `lmsysorg/sglang`: Свой специфичный environment.

Оркестратор должен знать, как установить пакеты в каждый из них, не хардкодя команды `pip install` повсюду.

## Решение: Package Manager Abstraction

1.  **Конфигурация (VLM Base)**:
    *   В `vlm_base.csv` (или будущем YAML реестре моделей) добавить поле `package_manager`.
    *   Возможные значения: `pip`, `uv`, `conda` (на будущее).
    *   Default: `pip` (для совместимости с чужими образами).

2.  **Модуль `DependencyInjector`**:
    *   Создать класс, который принимает:
        *   `container`: объект Docker-контейнера.
        *   `packages`: список пакетов (строки).
        *   `manager_type`: тип менеджера (`pip` / `uv`).
    *   Реализует логику формирования команды установки:
        *   `pip`: `python -m pip install package1 package2`
        *   `uv`: `uv pip install --system package1 package2` (флаг `--system` важен внутри контейнера).

3.  **Интеграция с Оркестратором**:
    *   В методе `run_container` (или перед ним) оркестратор определяет тип менеджера из конфигурации модели.
    *   Вызывает `DependencyInjector` для генерации команды установки.
    *   Эта команда передается как часть `entrypoint` или выполняется через `docker exec` перед запуском скрипта.

## Подзадачи

1.  **Обновить схему VLM Registry**: Добавить колонку/поле `package_manager`.
2.  **Реализовать `DependencyInjector`**: В `packages/bench_utils` или `orchestrator_utils`.
3.  **Обновить `run_container`**: Использовать инжектор для формирования `install_cmd`.

## Ожидаемый результат
*   Оркестратор корректно устанавливает зависимости как в стандартные образы (vLLM), так и в оптимизированные (uv).
*   Добавление поддержки нового менеджера (например, `poetry`) требует изменений только в одном классе.