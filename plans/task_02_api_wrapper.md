# Задача 2: Реализация API Wrapper (FastAPI) ✅ ВЫПОЛНЕНО

## Результаты
1.  **Модульная архитектура**: API Wrapper разделен на легковесное ядро (`packages/api_wrapper`) и динамически загружаемые адаптеры.
2.  **Control Plane API**: Реализованы эндпоинты `/v1/model/load` и `/v1/model/unload` для управления жизненным циклом моделей.
3.  **Безопасность**: Внедрена авторизация через `X-API-Key`, безопасная передача секретов через поле `env` и автоматическая маскировка токенов в логах.
4.  **Телеметрия**: Интегрирован сбор метрик Latency, Peak VRAM и системных ресурсов через фоновый Watchdog.
5.  **Тестирование**: Пакет покрыт тестами. *Примечание: Интеграционные тесты, проверяющие авторизацию и механизмы управления моделями в реальной сетевой среде, отложены до этапа экспериментов с контейнерами и оркестратором.*

## Цель
Создать унифицированный HTTP-интерфейс (OpenAI-compatible) для взаимодействия с различными инференс-движками (vLLM, SGLang, HF) внутри Docker-контейнера модели.

## Контекст
См. [ADR-003: API Wrapper для инференса](../docs_site/docs/architecture/adr/003-api-wrapper.md).
Необходимо абстрагировать детали конкретных бэкендов и обеспечить централизованный сбор метрик производительности.

## Подзадачи

1.  **FastAPI Application (Core)**: ✅ ВЫПОЛНЕНО
    *   Создано базовое приложение FastAPI с использованием `lifespan`.
    *   Реализован эндпоинт `POST /v1/chat/completions` (Data Plane).
    *   Реализованы эндпоинты `POST /v1/model/load` и `POST /v1/model/unload` (Control Plane).
    *   Поддержаны `model_params` и `env` (для секретов) в запросах.

2.  **Telemetry & Monitoring**: ✅ ВЫПОЛНЕНО
    *   Реализован `TelemetryManager` для замера Latency и Peak VRAM.
    *   Интегрирован `nvidia-ml-py` для точного мониторинга GPU.
    *   Реализован `ResourceWatchdog` — фоновый процесс (интервал 100мс) для сбора метрик CPU, RAM и GPU.

3.  **Security**: ✅ ВЫПОЛНЕНО
    *   Внедрена авторизация через заголовок `X-API-Key`.
    *   Реализована безопасная передача токенов через API и маскировка секретов в логах.

4.  **Backend Adapters Architecture**: ✅ ВЫПОЛНЕНО
    *   **AbstractBackend**: Базовый интерфейс вынесен в ядро.
    *   **Динамическая загрузка**: Реализован механизм `importlib` для загрузки адаптеров JIT.
    *   **Модульность**: Адаптеры вынесены в отдельные пакеты (`vllm-adapter`, `deepseek-adapter`).

## Ожидаемый результат
*   Python-пакет `packages/api_wrapper`.
*   Запускаемый сервер (через `uvicorn`), принимающий запросы в формате OpenAI Chat Completions.
*   Ответы содержат сгенерированный текст и метаданные о производительности.