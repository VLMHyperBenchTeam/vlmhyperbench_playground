# Инструкция по обновлению до uv 0.8.2

Данный документ описывает пошаговый процесс обновления проекта `vlm-hyperbench` с версии `uv` 0.7.18 до версии 0.8.2. Обновление включает в себя критические изменения, поэтому важно следовать инструкциям внимательно.

## 1. Подготовка

Перед началом обновления необходимо выполнить следующие шаги для обеспечения безопасности и возможности отката.

## 2. Анализ и адаптация под критические изменения

Версия `uv` 0.8.0 внесла несколько критических изменений, которые могут повлиять на ваш workflow. Ниже приведены ключевые изменения и необходимые действия.

## 3. Тестирование в dev-режиме

После подготовки выполните полную установку в dev-режиме, чтобы проверить совместимость.

### 3.3. Проверка ключевых функций
*   **Рабочие области (Workspaces):** Убедитесь, что все пакеты из `packages/*` (например, `bench-utils`, `model-interface`) успешно установлены в editable-режиме. Запустите тестовый импорт:
    ```bash
    uv run python -c "from bench_utils import metrics; print('bench_utils imported')"
    ```
*   **Запуск скриптов:** Попробуйте запустить один из основных скриптов проекта.
    ```bash
    uv run python check_classification.py
    ```
*   **Docker-сборка:** Если возможно, выполните сборку dev-образа, чтобы убедиться, что процесс не нарушается.
    ```bash
    docker build -f docker/Dockerfile-uv --target dev -t vlm-hyperbench:dev-test .
    ```

## 4. Тестирование staging и prod-режимов

После успешного тестирования в dev-режиме, проверьте staging и prod-окружения.

### 4.1. Staging-режим
```bash
# Пересчет lock-файла для staging
uv lock --project staging

# Установка окружения строго по lock-файлу
uv sync --project staging --frozen --extra cu124
```

### 4.2. Prod-режим
```bash
# Пересчет lock-файла для prod
uv lock --project prod

# Установка окружения строго по lock-файлу
uv sync --project prod --frozen --extra cu124
```

## 5. Обновление документации

После успешного тестирования всех режимов, обновите документацию, чтобы отразить изменения.

*   В `docs/docs_new/03_environment_setup.md` замените все упоминания `uv version` на `uv self version`.
*   При необходимости, добавьте примечание о новом поведении `uv python pin --rm` в раздел "Частые проблемы".

## 6. Завершение

Если все тесты пройдены успешно:
1.  Закоммитьте изменения (включая обновленную документацию).
2.  Создайте Pull Request из ветки `upgrade/uv-0.8.2` в основную ветку.
3.  После ревью и мержа, уведомите команду об обновлении.